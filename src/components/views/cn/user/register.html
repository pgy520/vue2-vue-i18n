<div class="entrance-container" id="register_area">
    <h2 v-if="register_show"><%- LANG('注册会员') %></h2>
    <div class="form-content" v-if="logined_unactive" id="regiserContentId">
        <div class="form-prompt"><p><%- LANG('以下表单均为必填项，请您如实填写。') %></p></div>
        <div class="form-grid">
            <div class="gridcontainer">
                <div class="grid"><input placeholder="<%- LANG('姓') %>" type="text" v-model="lastName"></div>
                <div class="grid"><input placeholder="<%- LANG('名') %>" type="text" v-model="firstName"></div>
            </div>
        </div>
        <div class="form-grid">
            <input placeholder="<%- LANG('邮箱') %>" type="text" v-model="mail">
        </div>
        <div class="form-grid">
            <input autocomplete="new-password" placeholder="<%- LANG('密码') %>" type="password" v-model="password">
        </div>
        <div class="form-grid">
            <input autocomplete="new-password" placeholder="<%- LANG('确认密码') %>" type="password" v-model="repassword">
        </div>
        <div class="form-grid">
            <input type="tel" id="phone" placeholder="<%- LANG('手机') %>" >
        </div>

        <div class="form-grid">
            <label><%- LANG('出生日期') %></label>
            <div class="gridcontainer">
                <div class="grid">
                    <select id="year" name="year" v-model="year">
                        <option value="-1"><%- LANG('年') %></option>
                        <option value="2018">2018</option>
                        <option value="2017">2017</option>
                        <option value="2016">2016</option>
                        <option value="2015">2015</option>
                        <option value="2014">2014</option>
                        <option value="2013">2013</option>
                        <option value="2012">2012</option>
                        <option value="2011">2011</option>
                        <option value="2010">2010</option>
                        <option value="2009">2009</option>
                        <option value="2008">2008</option>
                        <option value="2007">2007</option>
                        <option value="2006">2006</option>
                        <option value="2005">2005</option>
                        <option value="2004">2004</option>
                        <option value="2003">2003</option>
                        <option value="2002">2002</option>
                        <option value="2001">2001</option>
                        <option value="2000">2000</option>
                        <option value="1999">1999</option>
                        <option value="1998">1998</option>
                        <option value="1997">1997</option>
                        <option value="1996">1996</option>
                        <option value="1995">1995</option>
                        <option value="1994">1994</option>
                        <option value="1993">1993</option>
                        <option value="1992">1992</option>
                        <option value="1991">1991</option>
                        <option value="1990">1990</option>
                        <option value="1989">1989</option>
                        <option value="1988">1988</option>
                        <option value="1987">1987</option>
                        <option value="1986">1986</option>
                        <option value="1985">1985</option>
                        <option value="1984">1984</option>
                        <option value="1983">1983</option>
                        <option value="1982">1982</option>
                        <option value="1981">1981</option>
                        <option value="1980">1980</option>
                        <option value="1979">1979</option>
                        <option value="1978">1978</option>
                        <option value="1977">1977</option>
                        <option value="1976">1976</option>
                        <option value="1975">1975</option>
                        <option value="1974">1974</option>
                        <option value="1973">1973</option>
                        <option value="1972">1972</option>
                        <option value="1971">1971</option>
                        <option value="1970">1970</option>
                        <option value="1969">1969</option>
                        <option value="1968">1968</option>
                        <option value="1967">1967</option>
                        <option value="1966">1966</option>
                        <option value="1965">1965</option>
                        <option value="1964">1964</option>
                        <option value="1963">1963</option>
                        <option value="1962">1962</option>
                        <option value="1961">1961</option>
                        <option value="1960">1960</option>
                        <option value="1959">1959</option>
                        <option value="1958">1958</option>
                        <option value="1957">1957</option>
                        <option value="1956">1956</option>
                        <option value="1955">1955</option>
                        <option value="1954">1954</option>
                        <option value="1953">1953</option>
                        <option value="1952">1952</option>
                        <option value="1951">1951</option>
                        <option value="1950">1950</option>
                        <option value="1949">1949</option>
                        <option value="1948">1948</option>
                        <option value="1947">1947</option>
                        <option value="1946">1946</option>
                        <option value="1945">1945</option>
                        <option value="1944">1944</option>
                        <option value="1943">1943</option>
                        <option value="1942">1942</option>
                        <option value="1941">1941</option>
                        <option value="1940">1940</option>
                        <option value="1939">1939</option>
                        <option value="1938">1938</option>
                        <option value="1937">1937</option>
                        <option value="1936">1936</option>
                        <option value="1935">1935</option>
                        <option value="1934">1934</option>
                        <option value="1933">1933</option>
                        <option value="1932">1932</option>
                        <option value="1931">1931</option>
                        <option value="1930">1930</option>
                        <option value="1929">1929</option>
                        <option value="1928">1928</option>
                        <option value="1927">1927</option>
                        <option value="1926">1926</option>
                        <option value="1925">1925</option>
                        <option value="1924">1924</option>
                        <option value="1923">1923</option>
                        <option value="1922">1922</option>
                        <option value="1921">1921</option>
                        <option value="1920">1920</option>
                        <option value="1919">1919</option>
                        <option value="1918">1918</option>
                        <option value="1917">1917</option>
                        <option value="1916">1916</option>
                        <option value="1915">1915</option>
                        <option value="1914">1914</option>
                        <option value="1913">1913</option>
                        <option value="1912">1912</option>
                        <option value="1911">1911</option>
                        <option value="1910">1910</option>
                        <option value="1909">1909</option>
                        <option value="1908">1908</option>
                        <option value="1907">1907</option>
                        <option value="1906">1906</option>
                        <option value="1905">1905</option>
                        <option value="1904">1904</option>
                        <option value="1903">1903</option>
                        <option value="1902">1902</option>
                        <option value="1901">1901</option>
                        <option value="1900">1900</option>
                    </select>
                    <span class="arrow"></span>
                </div>
                <div class="grid">
                    <select id="month" name="month" @change="triggerDay" v-model="mon">
                        <option value="-1"><%- LANG('月') %></option>
                        <option value="1"><%- LANG('一月') %></option>
                        <option value="2"><%- LANG('二月') %></option>
                        <option value="3"><%- LANG('三月') %></option>
                        <option value="4"><%- LANG('四月') %></option>
                        <option value="5"><%- LANG('五月') %></option>
                        <option value="6"><%- LANG('六月') %> </option>
                        <option value="7"><%- LANG('七月') %></option>
                        <option value="8"><%- LANG('八月') %></option>
                        <option value="9"><%- LANG('九月') %></option>
                        <option value="10"><%- LANG('十月') %></option>
                        <option value="11"><%- LANG('十一月') %></option>
                        <option value="12"><%- LANG('十二月') %></option>
                    </select>
                    <span class="arrow"></span>
                </div>

                <div class="grid">
                    <select id="day" name="day" v-model="day">
                        <option  value="-1" selected><%- LANG('日') %></option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option  class="option_hide" value="31">31</option>
                    </select>
                    <span class="arrow"></span>
                </div>
            </div>
        </div>
        <div class="form-grid">
            <input placeholder="<%- LANG('图形验证码') %>" type="text" v-model="verifyCode">
            <a role="button" class="code-button" @click="reloadVerifyImg"><img id="vierfiyImgId" :src="verifyImgUrl"/></a>
        </div>
        <button type="submit" role="button" @click="register"><%- LANG('下一步') %></button>
    </div>

    <div class="form-content" id="mailActiveId" v-if="!logined_unactive">
        <div class="form-prompt">
            <p v-html="emailKeyResult"></p>
        </div>
        <div class="form-grid">
            <input placeholder="<%- LANG('邮箱验证码') %>" type="text" v-model="activeCode">
            <a role="button" class="code-button" @click="getActiveCode"><%- LANG('重新获取') %></a>
        </div>
        <button type="submit" role="button" @click="submitActiveCode"><%- LANG('提交') %></button>
    </div>

    <div class="switch" v-if="register_show"><%- LANG('已注册？') %><a href="/user/login"><%- LANG('登录') %></a></div>
</div>

<script>
    var app = new Vue({
        el: '#register_area',
        data: function () {
            return {
                //登陆情况下邮箱未激活
                logined_unactive:true,
                //注册会员是否显示
                register_show:true,



                lastName: "",//姓
                firstName: "",//名
                mail: "",
                password: "",
                repassword: "",
                region_code: "region_code",
                phone: "",
                year: "-1",
                mon: "-1",
                day: "-1",
                verifyCode: "",
                activeCode: "",
                mailRegx: /^([.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,//邮箱正则
            verifyImgUrl: DOMAIN_MAIN +  '/portals/validatecode/getvalidatecode',

                countryData:""
            }
        },
        computed : {
            emailKeyResult : function () {
//                return UB.L('邮箱验证码已发送至您的邮箱x，请注意查收。若长时间没有收到邮件，请重新获取。', this.mail);
            }
            },

        methods: {
            //点击刷新图形验证码
            reloadVerifyImg:function(){
                var imageObj = document.getElementById("vierfiyImgId");
                imageObj.src = this.verifyImgUrl+"?"+"date="+ (new Date()).getTime();

            },
            //2月份删掉特殊的31号
            triggerDay: function(sel){
                if(sel.target.value == 2){
                    $('option.option_hide').hide();
                }
                else{
                    $('option.option_hide').show();
                }
            },
            //发送验证码
            //注册
            register: function () {
                  this.region_code= "+" +  $("#phone").intlTelInput("getSelectedCountryData").dialCode;
                  this.phone = $("#phone").intlTelInput("getNumber");
                if (!this.verify()) {
                    return;
                }
                var _this = this;

                Methods.ajax({
                    type: 'POST',
                    data: {
                        login_name: this.mail,//用户名
                        password: this.password,//密码
                        repassword: this.repassword,//密码
                        mail: this.mail,//邮箱
                        lang: "ch",//语言类型  目前只有 en和ch
                        phone: this.phone,//电话号码
                        region_code: this.region_code,//国家区位码
                        birthday: this.year + "-" + this.mon + "-" + this.day,//生日
                        first_name: this.firstName,//名
                        last_name: this.lastName,//姓
                        verificationCode: this.verifyCode //验证码,
                    },
                    url: DOMAIN_MAIN + '/portals/register',
                    success: function (res) {
                        _this.logined_unactive=false;
                        // document.getElementById("mailActiveId").style = "";
                        // document.getElementById("regiserContentId").style = "display:none";

                    },
                    error: function (res) {
                        if(res.code== 1){//邮箱已经注册
                            JuaBox.info(UB.L("邮箱已经注册"));
                        }
                        else if(res.code==2 ){//两次密码不同
                            JuaBox.info(UB.L("密码输入不一致"));
                        }
                        else if(res.code==3){//验证码错误
                            JuaBox.info(UB.L("验证码错误"));
                        }
                        else{
                            JuaBox.info(UB.L("邮箱注册失败"));
                        }
                        _this.reloadVerifyImg();
                    }
                });
            },
            //发送验证码
            getActiveCode: function () {
                Methods.ajax({
                    type: 'POST',
                    data: {},
                    url: DOMAIN_MAIN + '/portals/mailActiveCode',
                    success: function (res) {
                        JuaBox.info(UB.L("发送验证码成功,请检查您的邮箱"));
                    },
                    error: function (res) {
                        JuaBox.info(UB.L("发送验证码失败"));
                    }
                });
            },

            //提交验证码
            submitActiveCode: function () {
                Methods.ajax({
                    type: 'GET',
                    url: DOMAIN_MAIN + '/portals/active?code=' + this.activeCode,
                    success: function (res) {
                        window.sessionStorage.getItem('mail')?window.sessionStorage.removeItem('mail'):''
                        JuaBox.info(UB.L("邮箱激活成功"),function(){
                            window.location="/user/login";
                        });


                    },
                    error: function (res) {
                            JuaBox.info(UB.L("邮箱激活失败"));
                    }
                });
            },

            //验证字符串是否是正确的mail格式
            isEmail: function(str){
                return this.mailRegx.test(str);
            },
            //验证from 不能为空 和两次密码是否填写正确
            verify: function () {

                if (this.lastName == "") {
                    JuaBox.info(UB.L("姓不能为空"));
                    return false;
                }

                if (this.firstName == "") {
                    JuaBox.info(UB.L("名不能为空"));
                    return false;
                }
                if (this.mail == "") {
                    JuaBox.info(UB.L("邮箱不能为空"));
                    return false;
                }
                if(!this.isEmail(this.mail)){
                    JuaBox.info(UB.L("无效邮箱格式"));
                    return false;
                }

                if (this.password == "") {
                    JuaBox.info(UB.L("密码不能为空"));
                    return false;
                }

                if (this.repassword == "") {
                    JuaBox.info(UB.L("确认密码不能为空"));
                    return false;
                }
                if(this.password.length <6 || this.repassword.length <6  ){
                    JuaBox.info(UB.L("密码最小长度为6位"));
                    return false;
                }

                if (this.repassword != this.password) {
                    JuaBox.info(UB.L("两次密码不一致"));
                    return false;
                }


                if (this.phone == "") {
                    JuaBox.info(UB.L("手机号不能为空"));
                    return false;
                }

                if (this.year == "" || this.year=="-1") {
                    JuaBox.info(UB.L("年份不能为空"));
                    return false;
                }

                if (this.mon == "" || this.mon =="-1") {
                    JuaBox.info(UB.L("月份不能为空"));
                    return false;
                }


                if (this.day == "" || this.day == "-1") {
                    JuaBox.info(UB.L("日期不能为空"));
                    return false;
                }


                return true;


            }


        },

        created: function () {
            $(document).ready(function(){
                if(window.sessionStorage.getItem('unactive')&&window.sessionStorage.getItem('mail'))
                {
                    this.logined_unactive=false;
                    this.register_show=false;
                }
            })
        },
        mounted: function () {

        }
    });
</script>